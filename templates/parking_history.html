<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Parking History</title>
</head>
<body>
    <h1>My Parking History</h1>
    <p><a href="{{ url_for('user_dashboard') }}">Back to Dashboard</a></p>
    <hr>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="text-align: left;">
                <th style="padding: 8px;">Lot Name</th>
                <th style="padding: 8px;">Spot Number</th>
                <th style="padding: 8px;">Parked At</th>
                <th style="padding: 8px;">Left At</th>
                <th style="padding: 8px;">Duration</th>
                <th style="padding: 8px;">Cost</th>
            </tr>
        </thead>
        <tbody>
            {% for res in reservations %}
            <tr>
                <td style="padding: 8px;">{{ res.spot.lot.prime_location_name if res.spot else 'DELETED LOT' }}</td>
                <td style="padding: 8px;">{{ res.spot.spot_number if res.spot else 'N/A' }}</td>
                <td style="padding: 8px;">{{ res.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td style="padding: 8px;">{{ res.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td style="padding: 8px;">
                    {% if res.leaving_timestamp and res.parking_timestamp %}
                        {% set duration = res.leaving_timestamp - res.parking_timestamp %}
                        {% set hours = duration.total_seconds() // 3600 %}
                        {% set minutes = (duration.total_seconds() % 3600) // 60 %}
                        {{ hours | int }} hours, {{ minutes | int }} minutes
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td style="padding: 8px;">
                    {% if res.parking_cost is not none %}
                        â‚¹{{ "%.2f"|format(res.parking_cost) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="padding: 8px; text-align: center;">You have no past parking records.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>