<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Parking History</title>
</head>
<body>
    <h1>My Parking History</h1>
    <p><a href="{{ url_for('user_dashboard') }}">Back to Dashboard</a></p>
    <hr>
    <table border="1">
        <thead>
            <tr>
                <th>Lot Name</th>
                <th>Spot Number</th>
                <th>Parked At</th>
                <th>Left At</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
            {% for res in reservations %}
            <tr>
                <td>{{ res.spot.lot.prime_location_name }}</td>
                <td>{{ res.spot.spot_number }}</td>
                <td>{{ res.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ res.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    {% if res.leaving_timestamp and res.parking_timestamp %}
                        {% set duration = res.leaving_timestamp - res.parking_timestamp %}
                        {% set hours = duration.total_seconds() // 3600 %}
                        {% set minutes = (duration.total_seconds() % 3600) // 60 %}
                        {{ hours | int }} hours, {{ minutes | int }} minutes
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">You have no past parking records.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>