<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>History for {{ target_user.full_name }}</title>
</head>
<body>
    <h1>Parking History for {{ target_user.full_name }}</h1>
    <p><strong>Email:</strong> {{ target_user.username }}</p>
    <p><a href="{{ url_for('admin_dashboard') }}">Back to Main Dashboard</a></p>
    <hr>

    <h3>All Reservations</h3>
    <table border="1">
        <thead>
            <tr>
                <th>Lot</th>
                <th>Spot</th>
                <th>Parked At</th>
                <th>Left At</th>
                <th>Duration</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for res in reservations %}
            <tr>
                <td>{{ res.spot.lot.prime_location_name }}</td>
                <td>{{ res.spot.spot_number }}</td>
                <td>{{ res.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    {% if res.leaving_timestamp %}
                        {{ res.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}
                    {% else %}
                        Currently Parked
                    {% endif %}
                </td>
                <td>
                    {% if res.leaving_timestamp and res.parking_timestamp %}
                        {% set duration = res.leaving_timestamp - res.parking_timestamp %}
                        {% set hours = duration.total_seconds() // 3600 %}
                        {% set minutes = (duration.total_seconds() % 3600) // 60 %}
                        {{ hours | int }} hours, {{ minutes | int }} minutes
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if res.leaving_timestamp %}
                        Completed
                    {% else %}
                        Active
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6">This user has no parking records.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>