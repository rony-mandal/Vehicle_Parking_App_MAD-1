<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>History for {{ target_user.full_name }}</title>
</head>
<body>
    <h1>Parking History for {{ target_user.full_name }}</h1>
    <p><strong>Email:</strong> {{ target_user.username }}</p>
    <p><a href="{{ url_for('admin_dashboard') }}">Back to Main Dashboard</a></p>
    <hr>
    
    <h3>All Reservations</h3>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="text-align: left;">
                <th style="padding: 8px;">Lot</th>
                <th style="padding: 8px;">Spot</th>
                <th style="padding: 8px;">Parked At</th>
                <th style="padding: 8px;">Left At</th>
                <th style="padding: 8px;">Duration</th>
                <th style="padding: 8px;">Status</th>
                <th style="padding: 8px;">Cost</th>
            </tr>
        </thead>
        <tbody>
            {% for res in reservations %}
            <tr>
                <td style="padding: 8px;">{{ res.spot.lot.prime_location_name if res.spot else 'DELETED LOT' }}</td>
                <td style="padding: 8px;">{{ res.spot.spot_number if res.spot else 'N/A' }}</td>
                <td style="padding: 8px;">{{ res.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                <td style="padding: 8px;">
                    {% if res.leaving_timestamp %}
                        {{ res.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}
                    {% else %}
                        Currently Parked
                    {% endif %}
                </td>
                <td style="padding: 8px;">
                    {% if res.leaving_timestamp and res.parking_timestamp %}
                        {% set duration = res.leaving_timestamp - res.parking_timestamp %}
                        {% set hours = duration.total_seconds() // 3600 %}
                        {% set minutes = (duration.total_seconds() % 3600) // 60 %}
                        {{ hours | int }} hours, {{ minutes | int }} minutes
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td style="padding: 8px;">
                    {% if res.leaving_timestamp %}
                        Completed
                    {% else %}
                        Active
                    {% endif %}
                </td>
                <td style="padding: 8px;">
                    {% if res.parking_cost is not none %}
                        â‚¹{{ "%.2f"|format(res.parking_cost) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="padding: 8px; text-align: center;">This user has no parking records.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>